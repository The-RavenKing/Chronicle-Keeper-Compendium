<div class="race-importer-window">
  <div class="race-importer-tabs">
    <div class="race-importer-tab active" data-tab="url">
      <i class="fas fa-globe"></i> {{localize "RACE_IMPORTER.URLTab"}}
    </div>
    <div class="race-importer-tab" data-tab="text">
      <i class="fas fa-file-alt"></i> {{localize "RACE_IMPORTER.TextTab"}}
    </div>
    <div class="race-importer-tab" data-tab="settings">
      <i class="fas fa-cogs"></i> {{localize "RACE_IMPORTER.SettingsTab"}}
    </div>
  </div>

  <div id="url-content" class="race-importer-content active">
    <div class="race-importer-instructions">
      <i class="fas fa-info-circle"></i> {{localize "RACE_IMPORTER.Instructions"}}
    </div>

    <div class="race-importer-form-group">
      <label for="race-url">{{localize "RACE_IMPORTER.URL"}}</label>
      <input type="text" id="race-url" placeholder="e.g. https://www.dndbeyond.com/races/tabaxi">
    </div>

    <div class="race-importer-button-row">
      <button id="fetch-url-btn" class="race-importer-button secondary">
        <i class="fas fa-cloud-download-alt"></i> {{localize "RACE_IMPORTER.FetchURL"}}
      </button>
    </div>

    <div class="race-importer-form-group">
      <label for="url-preview">Content Preview</label>
      <textarea id="url-preview" readonly placeholder="Fetched content will appear here..."></textarea>
    </div>

    <div class="race-importer-button-row">
      <button id="import-url-btn" class="race-importer-button">
        <i class="fas fa-magic"></i> {{localize "RACE_IMPORTER.Import"}}
      </button>
    </div>
  </div>

  <div id="text-content" class="race-importer-content">
    <div class="race-importer-instructions">
      <i class="fas fa-paste"></i> Paste race/species information below. The AI will extract Name, Speed, Size, Traits, and more automatically.
    </div>

    <div class="race-importer-form-group">
      <label for="race-text">{{localize "RACE_IMPORTER.Text"}}</label>
      <textarea id="race-text" placeholder="Paste race data here (PDF copy, Wiki text, Homebrew)..."></textarea>
    </div>

    <div class="race-importer-button-row">
      <button id="import-text-btn" class="race-importer-button">
        <i class="fas fa-magic"></i> {{localize "RACE_IMPORTER.Import"}}
      </button>
    </div>
  </div>

  <div id="settings-content" class="race-importer-content">
    
    <div class="race-importer-settings-grid">
      <div>
        <div class="race-importer-form-group">
          <label for="ollama-url"><i class="fas fa-server"></i> {{localize "RACE_IMPORTER.OllamaURL"}}</label>
          <input type="text" id="ollama-url" value="{{ollamaUrl}}">
        </div>
        <div class="race-importer-form-group">
          <label for="system-type"><i class="fas fa-dice-d20"></i> {{localize "RACE_IMPORTER.SystemType"}}</label>
          <select id="system-type">
            <option value="dnd5e" {{#if (eq systemType "dnd5e")}}selected{{/if}}>D&D 5th Edition</option>
            <option value="pf2e" {{#if (eq systemType "pf2e")}}selected{{/if}}>Pathfinder 2nd Edition</option>
            <option value="generic" {{#if (eq systemType "generic")}}selected{{/if}}>Generic/Other</option>
          </select>
        </div>
        <div class="race-importer-form-group">
          <label for="target-compendium"><i class="fas fa-book"></i> Species Compendium</label>
          <select id="target-compendium">
            <option value="">-- Select Compendium --</option>
            {{#each compendiums}}
              <option value="{{this.id}}" {{#if (eq this.id ../selectedCompendium)}}selected{{/if}}>
                {{this.name}}
              </option>
            {{/each}}
          </select>
        </div>
      </div>

      <div>
        <div class="race-importer-form-group">
          <label for="ollama-model"><i class="fas fa-brain"></i> {{localize "RACE_IMPORTER.OllamaModel"}}</label>
          <input type="text" id="ollama-model" value="{{ollamaModel}}">
        </div>
        
        <div class="race-importer-form-group" style="height: 64px;"></div> 

        <div class="race-importer-form-group">
          <label for="traits-compendium"><i class="fas fa-list"></i> Traits Compendium (Optional)</label>
          <select id="traits-compendium">
            <option value="">-- Use Same as Species --</option>
            {{#each compendiums}}
              <option value="{{this.id}}" {{#if (eq this.id ../selectedTraitsCompendium)}}selected{{/if}}>
                {{this.name}}
              </option>
            {{/each}}
          </select>
        </div>
      </div>
    </div>

    <div class="race-importer-button-row">
      <button id="relink-compendiums-btn" class="race-importer-button secondary" title="Repair broken compendium links">
        <i class="fas fa-sync"></i> Relink Compendiums
      </button>
      <button id="test-connection-btn" class="race-importer-button secondary">
        <i class="fas fa-plug"></i> {{localize "RACE_IMPORTER.TestConnection"}}
      </button>
    </div>

    <div class="setup-info">
      <h4><i class="fas fa-lightbulb"></i> Quick Setup</h4>
      <ol>
        <li>Make sure <strong>Ollama</strong> is running (<a href="http://localhost:11434" target="_blank">check here</a>)</li>
        <li>Ensure you have the model installed: <code>ollama run {{ollamaModel}}</code></li>
        <li>Use <strong>Relink Compendiums</strong> if you see "Compendium not found" errors.</li>
      </ol>
    </div>
  </div>

  <div class="race-importer-status"></div>
</div>